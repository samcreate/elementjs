<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Util</span><span class="PUNC">=</span><span class="NAME">window.Util</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.hexToRGB</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_hex</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.cache</span><span class="PUNC">=</span><span class="NAME">this.cache</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.cache</span><span class="PUNC">[</span><span class="NAME">p_hex</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.cache</span><span class="PUNC">[</span><span class="NAME">p_hex</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">=</span><span class="REGX">/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i</span><span class="PUNC">.</span><span class="NAME">exec</span><span class="PUNC">(</span><span class="NAME">p_hex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_r</span><span class="PUNC">=</span><span class="NAME">result</span><span class="PUNC">?</span><span class="PUNC">{</span><span class="NAME">r</span><span class="PUNC">:</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">:</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.cache</span><span class="PUNC">[</span><span class="NAME">p_hex</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">_r</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_r</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.RGBtoHSV</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">/</span><span class="NUMB">255</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">/</span><span class="NUMB">255</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">/</span><span class="NUMB">255</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">=</span><span class="NAME">max</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">max</span><span class="PUNC">-</span><span class="NAME">min</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">max</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">/</span><span class="NAME">max</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">===</span><span class="NAME">min</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">&lt;</span><span class="NAME">b</span><span class="PUNC">?</span><span class="NUMB">6</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">-</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="NAME">h</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.HSVtoRGB</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NUMB">6</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NUMB">6</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">q</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">6</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">:</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">*</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NUMB">255</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.mixColors</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">Util.linearInterpolate</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">Util.linearInterpolate</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">Util.linearInterpolate</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Util.linearInterpolate</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.linearInterpolate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.createContext</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvas</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="STRN">"element-canvas_"</span><span class="PUNC">+</span><span class="NAME">p_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$$_canvas.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">canvas.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="NAME">canvas.width</span><span class="PUNC">=</span><span class="NAME">$$_canvas._canvas.width</span><span class="PUNC">;</span><span class="NAME">canvas.height</span><span class="PUNC">=</span><span class="NAME">$$_canvas._canvas.height</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">canvas</span><span class="PUNC">:</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">:</span><span class="NAME">canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.removeElement</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">p_id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_el.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.checkPIXEL</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_object</span><span class="PUNC">,</span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="NAME">p_y</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_context</span><span class="PUNC">=</span><span class="NAME">p_object.mouseDraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageData</span><span class="PUNC">=</span><span class="NAME">_context.getImageData</span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="PUNC">,</span><span class="NAME">p_y</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_x</span><span class="PUNC">+</span><span class="NAME">p_y</span><span class="PUNC">*</span><span class="NAME">imageData.width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">imageData.data</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.getPixel</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pixels</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pix</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">x</span><span class="PUNC">>=</span><span class="NAME">width</span><span class="PUNC">||</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">y</span><span class="PUNC">>=</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Util.clampPixel</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pixels</span><span class="PUNC">[</span><span class="NAME">pix</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.clampPixel</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">a</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">></span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.bilinearInterpolate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">nw</span><span class="PUNC">,</span><span class="NAME">ne</span><span class="PUNC">,</span><span class="NAME">sw</span><span class="PUNC">,</span><span class="NAME">se</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m0</span><span class="PUNC">,</span><span class="NAME">m1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r0</span><span class="PUNC">=</span><span class="NAME">nw</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g0</span><span class="PUNC">=</span><span class="NAME">nw</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NAME">nw</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a0</span><span class="PUNC">=</span><span class="NAME">nw</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r1</span><span class="PUNC">=</span><span class="NAME">ne</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g1</span><span class="PUNC">=</span><span class="NAME">ne</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">ne</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="PUNC">=</span><span class="NAME">ne</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g2</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r3</span><span class="PUNC">=</span><span class="NAME">se</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g3</span><span class="PUNC">=</span><span class="NAME">se</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b3</span><span class="PUNC">=</span><span class="NAME">se</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a3</span><span class="PUNC">=</span><span class="NAME">se</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">m0</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">a0</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">a1</span><span class="PUNC">;</span><span class="NAME">m1</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">a2</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">a3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">m0</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m1</span><span class="PUNC">;</span><span class="NAME">m0</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">r0</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">r1</span><span class="PUNC">;</span><span class="NAME">m1</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">r2</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">r3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">m0</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m1</span><span class="PUNC">;</span><span class="NAME">m0</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">g0</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">g1</span><span class="PUNC">;</span><span class="NAME">m1</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">g2</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">g3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">m0</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m1</span><span class="PUNC">;</span><span class="NAME">m0</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">b0</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">b1</span><span class="PUNC">;</span><span class="NAME">m1</span><span class="PUNC">=</span><span class="NAME">cx</span><span class="PUNC">*</span><span class="NAME">b2</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">b3</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">m0</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">m1</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.triangle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">Util.mod</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">&lt;</span><span class="NUMB">0.5</span><span class="PUNC">?</span><span class="NAME">r</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.mod</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">/</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">n</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.getIndex</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_child</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_i</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">$$_CHILDREN.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_child.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_i</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_i</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Util.getSize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p_obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_obj.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">loadXMLDoc</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="NAME">Util.getJSON</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_path</span><span class="PUNC">,</span><span class="NAME">p_callback</span><span class="PUNC">,</span><span class="NAME">p_scope</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmlhttp</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">;</span><span class="NAME">scope</span><span class="PUNC">=</span><span class="NAME">p_scope</span><span class="PUNC">||</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">window.XMLHttpRequest</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">xmlhttp</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">xmlhttp</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">ActiveXObject</span><span class="PUNC">(</span><span class="STRN">"Microsoft.XMLHTTP"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">xmlhttp.onreadystatechange</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xmlhttp.readyState</span><span class="PUNC">==</span><span class="NUMB">4</span><span class="PUNC">&&</span><span class="NAME">xmlhttp.status</span><span class="PUNC">==</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">json</span><span class="PUNC">=</span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">xmlhttp.responseText</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">json</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">xmlhttp.responseText</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">p_callback.call</span><span class="PUNC">(</span><span class="NAME">p_scope</span><span class="PUNC">,</span><span class="NAME">json</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="NAME">p_path</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">xmlhttp.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.Util</span><span class="PUNC">=</span><span class="NAME">Util</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Basic</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Basic.prototype</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Basic</span><span class="PUNC">;</span><span class="NAME">a.extend</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.destroy</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">$$_CHILDREN.length</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">$$_CHILDREN.splice</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.dirty</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._dirty</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._dirty</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.Basic</span><span class="PUNC">=</span><span class="NAME">Basic</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Animate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._tween</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Animate.prototype</span><span class="PUNC">;</span><span class="NAME">a.easing</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._easing</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._easing</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.time</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._time</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._time</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.easing</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._easing</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._easing</span><span class="PUNC">||</span><span class="STRN">"Linear.EaseNone"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.animate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._tween.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">props</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">time</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">easing</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">||</span><span class="NAME">this.easing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.start</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e.start</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="NAME">this._callback</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">||</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this._tweenie.to</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">props</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">easing</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this._nextTween</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.stop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.pause</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._nextTween</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._tween.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._tween.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._tweenie.to</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">props</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this._tween</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">easing</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">this._nextTween</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._tween.shift</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._callback</span><span class="PUNC">!==</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._callback.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.Animate</span><span class="PUNC">=</span><span class="NAME">Animate</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._listeners</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">EventTarget.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Basic</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">EventTarget</span><span class="PUNC">;</span><span class="NAME">a.bind</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">fn</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.unbind</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">e.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fn</span><span class="PUNC">===</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e.splice</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">break</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.fire</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">f</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">f.target</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f.target</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">f.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Event object missing 'type' property."</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f.params</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">f.type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this._listeners</span><span class="PUNC">[</span><span class="NAME">f.type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">e.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fn.call</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scope</span><span class="PUNC">||</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.EventTarget</span><span class="PUNC">=</span><span class="NAME">EventTarget</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Filter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_pt</span><span class="PUNC">=</span><span class="NAME">Filter.prototype</span><span class="PUNC">;</span><span class="NAME">_pt.constructor</span><span class="PUNC">=</span><span class="NAME">Filter</span><span class="PUNC">;</span><span class="NAME">Filter.get</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_src</span><span class="PUNC">,</span><span class="NAME">p_filter</span><span class="PUNC">,</span><span class="NAME">p_ref</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_img</span><span class="PUNC">;</span><span class="NAME">_img</span><span class="PUNC">=</span><span class="NAME">p_src.context.getImageData</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p_src.canvas.width</span><span class="PUNC">,</span><span class="NAME">p_src.canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_img</span><span class="PUNC">=</span><span class="NAME">Filter.filterImage</span><span class="PUNC">(</span><span class="NAME">p_filter.effect</span><span class="PUNC">,</span><span class="NAME">_img</span><span class="PUNC">,</span><span class="NAME">p_filter.args</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">p_ref</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">p_src.context.putImageData</span><span class="PUNC">(</span><span class="NAME">_img</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_src.canvas</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.filterImage</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_filter</span><span class="PUNC">,</span><span class="NAME">p_image</span><span class="PUNC">,</span><span class="NAME">var_args</span><span class="PUNC">,</span><span class="NAME">p_ref</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">p_image</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">args.push</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">args.push</span><span class="PUNC">[</span><span class="NAME">p_ref</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"Filter."</span><span class="PUNC">+</span><span class="NAME">p_filter</span><span class="PUNC">+</span><span class="STRN">".apply(p_ref, args)"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.grayscale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">d.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NUMB">0.2126</span><span class="PUNC">*</span><span class="NAME">r</span><span class="PUNC">+</span><span class="NUMB">0.7152</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">+</span><span class="NUMB">0.0722</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.brightness</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_adjustment</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">=</span><span class="NAME">p_adjustment</span><span class="PUNC">||</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hsv</span><span class="PUNC">=</span><span class="NAME">Util.RGBtoHSV</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">amount</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rgb</span><span class="PUNC">=</span><span class="NAME">Util.HSVtoRGB</span><span class="PUNC">(</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">hsv</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">rgb</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.threshold</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_threshold</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">d.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">0.2126</span><span class="PUNC">*</span><span class="NAME">r</span><span class="PUNC">+</span><span class="NUMB">0.7152</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">+</span><span class="NUMB">0.0722</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">>=</span><span class="NAME">p_threshold</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">255</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">,</span><span class="NAME">_color</span><span class="PUNC">=</span><span class="NAME">Util.hexToRGB</span><span class="PUNC">(</span><span class="NAME">p_color</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">d.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">n</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Filter.multiplyPixels</span><span class="PUNC">(</span><span class="NAME">_color.r</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Filter.multiplyPixels</span><span class="PUNC">(</span><span class="NAME">_color.g</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">Filter.multiplyPixels</span><span class="PUNC">(</span><span class="NAME">_color.b</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.sharpen</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Filter.convolute</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.emboss</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Filter.convolute</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.woodblock</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_temp</span><span class="PUNC">=</span><span class="NAME">Filter.sobel.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp</span><span class="PUNC">=</span><span class="NAME">Filter.multiply.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">_temp</span><span class="PUNC">,</span><span class="STRN">"#FF0000"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp</span><span class="PUNC">=</span><span class="NAME">Filter.threshold.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">_temp</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_temp</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.sobel</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">px</span><span class="PUNC">=</span><span class="NAME">p_pixels</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vertical</span><span class="PUNC">=</span><span class="NAME">Filter.convoluteFloat32</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">horizontal</span><span class="PUNC">=</span><span class="NAME">Filter.convoluteFloat32</span><span class="PUNC">(</span><span class="NAME">px</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">Filter.createImageData</span><span class="PUNC">(</span><span class="NAME">vertical.width</span><span class="PUNC">,</span><span class="NAME">vertical.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">id.data.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">vertical.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">horizontal.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">255</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.blur</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_amount</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width4</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">q</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">=</span><span class="NAME">p_amount</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">amount</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">amount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">amount</span><span class="PUNC">>=</span><span class="NUMB">2.5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">q</span><span class="PUNC">=</span><span class="NUMB">0.98711</span><span class="PUNC">*</span><span class="NAME">amount</span><span class="PUNC">-</span><span class="NUMB">0.9633</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">amount</span><span class="PUNC">>=</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">q</span><span class="PUNC">=</span><span class="NUMB">3.97156</span><span class="PUNC">-</span><span class="NUMB">4.14554</span><span class="PUNC">*</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NUMB">0.26891</span><span class="PUNC">*</span><span class="NAME">amount</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">q</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">amount</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">3.97156</span><span class="PUNC">-</span><span class="NUMB">4.14554</span><span class="PUNC">*</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NUMB">0.26891</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">qq</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">*</span><span class="NAME">q</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">qqq</span><span class="PUNC">=</span><span class="NAME">qq</span><span class="PUNC">*</span><span class="NAME">q</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b0</span><span class="PUNC">=</span><span class="NUMB">1.57825</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">2.44413</span><span class="PUNC">*</span><span class="NAME">q</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">1.4281</span><span class="PUNC">*</span><span class="NAME">qq</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">0.422205</span><span class="PUNC">*</span><span class="NAME">qqq</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">2.44413</span><span class="PUNC">*</span><span class="NAME">q</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">2.85619</span><span class="PUNC">*</span><span class="NAME">qq</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">1.26661</span><span class="PUNC">*</span><span class="NAME">qqq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">b0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1.4281</span><span class="PUNC">*</span><span class="NAME">qq</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NUMB">1.26661</span><span class="PUNC">*</span><span class="NAME">qqq</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">b0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b3</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">0.422205</span><span class="PUNC">*</span><span class="NAME">qqq</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">b0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bigB</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">b1</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">indexLast</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ppppixel</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">indexLast</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">&lt;=</span><span class="NAME">indexLast</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">bigB</span><span class="PUNC">*</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">ppixel</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">pppixel</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">ppppixel</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">}</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">indexLast</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">>=</span><span class="NAME">indexLast</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">bigB</span><span class="PUNC">*</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">ppixel</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">pppixel</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">ppppixel</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">indexLast</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">&lt;=</span><span class="NAME">indexLast</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">width4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">bigB</span><span class="PUNC">*</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">ppixel</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">pppixel</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">ppppixel</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">}</span><span class="NAME">index</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">width4</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">indexLast</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">>=</span><span class="NAME">indexLast</span><span class="PUNC">;</span><span class="NAME">index</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">width4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="NAME">bigB</span><span class="PUNC">*</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">*</span><span class="NAME">ppixel</span><span class="PUNC">+</span><span class="NAME">b2</span><span class="PUNC">*</span><span class="NAME">pppixel</span><span class="PUNC">+</span><span class="NAME">b3</span><span class="PUNC">*</span><span class="NAME">ppppixel</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">;</span><span class="NAME">ppppixel</span><span class="PUNC">=</span><span class="NAME">pppixel</span><span class="PUNC">;</span><span class="NAME">pppixel</span><span class="PUNC">=</span><span class="NAME">ppixel</span><span class="PUNC">;</span><span class="NAME">ppixel</span><span class="PUNC">=</span><span class="NAME">pixel</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.median</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">Filter.createImageData</span><span class="PUNC">(</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">p_pixels.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">p_pixels.width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">P</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">count</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">u</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">u</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">v</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">v</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">windowIndex</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_pixels.width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">windowIndex</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">windowIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">windowIndex</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">windowIndex</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">P</span><span class="PUNC">[</span><span class="NAME">count</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="STRN">"0.33"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">count</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">P.sort</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">imageIndex</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">p_pixels.width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">imageIndex</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">imageIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">imageIndex</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">P</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">id.data</span><span class="PUNC">[</span><span class="NAME">imageIndex</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">imageIndex</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newImageData</span><span class="PUNC">=</span><span class="NAME">Filter.createImageData</span><span class="PUNC">(</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">p_pixels.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">p_pixels.data.length</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">newImageData.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">255</span><span class="PUNC">-</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">newImageData.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">255</span><span class="PUNC">-</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">newImageData.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">255</span><span class="PUNC">-</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">newImageData.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newImageData</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.circleSmear</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_values</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outputData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">inputData.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vals</span><span class="PUNC">=</span><span class="NAME">p_values</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">density</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="NAME">mix</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">vals.size</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="NAME">size</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">density</span><span class="PUNC">=</span><span class="NAME">vals.density</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mix</span><span class="PUNC">=</span><span class="NAME">vals.mix</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radius</span><span class="PUNC">=</span><span class="NAME">size</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">radius2</span><span class="PUNC">=</span><span class="NAME">radius</span><span class="PUNC">*</span><span class="NAME">radius</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numShapes</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">density</span><span class="PUNC">/</span><span class="NUMB">30</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">numShapes</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">&</span><span class="NUMB">2147483647</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">width</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">32</span><span class="PUNC">)</span><span class="PUNC">&</span><span class="NUMB">2147483647</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rgb2</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">sx</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">sx</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">sy</span><span class="PUNC">-</span><span class="NAME">radius</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">sy</span><span class="PUNC">+</span><span class="NAME">radius</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">sy</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">sy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">&&</span><span class="NAME">y</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">&&</span><span class="NAME">f</span><span class="PUNC">&lt;=</span><span class="NAME">radius2</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rgb1</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mixedRGB</span><span class="PUNC">=</span><span class="NAME">Util.mixColors</span><span class="PUNC">(</span><span class="NAME">mix</span><span class="PUNC">,</span><span class="NAME">rgb1</span><span class="PUNC">,</span><span class="NAME">rgb2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">mixedRGB</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">&lt;</span><span class="NAME">outputData.length</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.diffuse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">=</span><span class="NAME">p_value</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outputData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sinTable</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cosTable</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">sinTable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">scale</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">cosTable</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">scale</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">transInverse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">255</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">=</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">distance</span><span class="PUNC">*</span><span class="NAME">sinTable</span><span class="PUNC">[</span><span class="NAME">angle</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">distance</span><span class="PUNC">*</span><span class="NAME">cosTable</span><span class="PUNC">[</span><span class="NAME">angle</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.transformFilter</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">transInverse</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.contrast</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">=</span><span class="NAME">p_value</span><span class="PUNC">||</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">amount</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">amount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">table</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">table</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">255</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">255</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">amount</span><span class="PUNC">+</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">Filter.tableFilter</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">table</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.sepia</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">data.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NUMB">0.393</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">*</span><span class="NUMB">0.769</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NUMB">0.189</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NUMB">0.349</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">*</span><span class="NUMB">0.686</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NUMB">0.168</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NUMB">0.272</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">*</span><span class="NUMB">0.534</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">*</span><span class="NUMB">0.131</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.dither</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outputData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">inputData.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_value</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p_value</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">levels</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">levels</span><span class="PUNC">=</span><span class="NAME">p_value.levels</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">color</span><span class="PUNC">=</span><span class="NAME">p_value.color</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">levels</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">levels</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matrix</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">7</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sum</span><span class="PUNC">=</span><span class="NUMB">7</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">levels</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NUMB">255</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">levels</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">256</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">div</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">levels</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">256</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">&</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">direction</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">index</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">direction</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">r1</span><span class="PUNC">=</span><span class="NAME">g1</span><span class="PUNC">=</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">r1</span><span class="PUNC">+</span><span class="NAME">g1</span><span class="PUNC">+</span><span class="NAME">b1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">div</span><span class="PUNC">[</span><span class="NAME">r1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g2</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">div</span><span class="PUNC">[</span><span class="NAME">g1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">div</span><span class="PUNC">[</span><span class="NAME">b1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">r2</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g2</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b2</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">er</span><span class="PUNC">=</span><span class="NAME">r1</span><span class="PUNC">-</span><span class="NAME">r2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eg</span><span class="PUNC">=</span><span class="NAME">g1</span><span class="PUNC">-</span><span class="NAME">g2</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eb</span><span class="PUNC">=</span><span class="NAME">b1</span><span class="PUNC">-</span><span class="NAME">b2</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iy</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">&lt;=</span><span class="NAME">iy</span><span class="PUNC">&&</span><span class="NAME">iy</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jx</span><span class="PUNC">=</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">&lt;=</span><span class="NAME">jx</span><span class="PUNC">&&</span><span class="NAME">jx</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">matrix</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">-</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">matrix</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">3</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">!==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">index</span><span class="PUNC">-</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">:</span><span class="NAME">index</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">r1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">g1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b1</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">factor</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NAME">sum</span><span class="PUNC">;</span><span class="NAME">r1</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">er</span><span class="PUNC">*</span><span class="NAME">factor</span><span class="PUNC">;</span><span class="NAME">g1</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">eg</span><span class="PUNC">*</span><span class="NAME">factor</span><span class="PUNC">;</span><span class="NAME">b1</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">eb</span><span class="PUNC">*</span><span class="NAME">factor</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">r1</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g1</span><span class="PUNC">;</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">index</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">direction</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">outputData.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.edge</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outputData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matrixH</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matrixV</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rh</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">gh</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">bh</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rv</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">gv</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">bv</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">row</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">row</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iy</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">row</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ioffset</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">iy</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">iy</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ioffset</span><span class="PUNC">=</span><span class="NAME">iy</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">ioffset</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">moffset</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">col</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">col</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ix</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">ix</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">ix</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">ix</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">}</span><span class="NAME">ix</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">ioffset</span><span class="PUNC">+</span><span class="NAME">ix</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">ioffset</span><span class="PUNC">+</span><span class="NAME">ix</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">ioffset</span><span class="PUNC">+</span><span class="NAME">ix</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">matrixH</span><span class="PUNC">[</span><span class="NAME">moffset</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NAME">matrixV</span><span class="PUNC">[</span><span class="NAME">moffset</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">rh</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bh</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gh</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">rv</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">*</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">gv</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bv</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">rh</span><span class="PUNC">*</span><span class="NAME">rh</span><span class="PUNC">+</span><span class="NAME">rv</span><span class="PUNC">*</span><span class="NAME">rv</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1.8</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">gh</span><span class="PUNC">*</span><span class="NAME">gh</span><span class="PUNC">+</span><span class="NAME">gv</span><span class="PUNC">*</span><span class="NAME">gv</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1.8</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">bh</span><span class="PUNC">*</span><span class="NAME">bh</span><span class="PUNC">+</span><span class="NAME">bv</span><span class="PUNC">*</span><span class="NAME">bv</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">1.8</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">outputData.length</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.kaleidoscope</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_values</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputData</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultValues</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">rotation</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sides</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="NAME">centerX</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="NAME">centerY</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueRanges</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">360</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">rotation</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">360</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">sides</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">30</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">centerX</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">centerY</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_values</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p_values</span><span class="PUNC">=</span><span class="NAME">defaultValues</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_values.angle</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">defaultValues.angle</span><span class="PUNC">:</span><span class="NAME">p_values.angle</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rotation</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_values.rotation</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">defaultValues.rotation</span><span class="PUNC">:</span><span class="NAME">p_values.rotation</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sides</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_values.sides</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">defaultValues.sides</span><span class="PUNC">:</span><span class="NAME">p_values.sides</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerX</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_values.centerX</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">defaultValues.centerX</span><span class="PUNC">:</span><span class="NAME">p_values.centerX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerY</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">p_values.centerY</span><span class="PUNC">===</span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">defaultValues.centerY</span><span class="PUNC">:</span><span class="NAME">p_values.centerY</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iCenterX</span><span class="PUNC">=</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NAME">centerX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">iCenterY</span><span class="PUNC">=</span><span class="NAME">height</span><span class="PUNC">*</span><span class="NAME">centerY</span><span class="PUNC">;</span><span class="NAME">angle</span><span class="PUNC">=</span><span class="NAME">angle</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="NAME">rotation</span><span class="PUNC">=</span><span class="NAME">rotation</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">transInverse</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">iCenterX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">iCenterY</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">*</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="NAME">dy</span><span class="PUNC">*</span><span class="NAME">dy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">=</span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">angle</span><span class="PUNC">-</span><span class="NAME">rotation</span><span class="PUNC">;</span><span class="NAME">theta</span><span class="PUNC">=</span><span class="NAME">Util.triangle</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">/</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NAME">sides</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">theta</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">angle</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iCenterX</span><span class="PUNC">+</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">iCenterY</span><span class="PUNC">+</span><span class="NAME">r</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.transformFilter</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">transInverse</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_pixels</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.transformFilter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">transformInverse</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outputData</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">inputData.length</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">transformInverse.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">out</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcX</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcY</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xWeight</span><span class="PUNC">=</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">srcX</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yWeight</span><span class="PUNC">=</span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">srcY</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nw</span><span class="PUNC">,</span><span class="NAME">ne</span><span class="PUNC">,</span><span class="NAME">sw</span><span class="PUNC">,</span><span class="NAME">se</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">srcX</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">srcX</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">srcY</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">&&</span><span class="NAME">srcY</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NAME">srcY</span><span class="PUNC">+</span><span class="NAME">srcX</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="NAME">nw</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">ne</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">sw</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">se</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">nw</span><span class="PUNC">=</span><span class="NAME">Util.getPixel</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">srcX</span><span class="PUNC">,</span><span class="NAME">srcY</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">ne</span><span class="PUNC">=</span><span class="NAME">Util.getPixel</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">srcX</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">srcY</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sw</span><span class="PUNC">=</span><span class="NAME">Util.getPixel</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">srcX</span><span class="PUNC">,</span><span class="NAME">srcY</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">se</span><span class="PUNC">=</span><span class="NAME">Util.getPixel</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">srcX</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">srcY</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rgba</span><span class="PUNC">=</span><span class="NAME">Util.bilinearInterpolate</span><span class="PUNC">(</span><span class="NAME">xWeight</span><span class="PUNC">,</span><span class="NAME">yWeight</span><span class="PUNC">,</span><span class="NAME">nw</span><span class="PUNC">,</span><span class="NAME">ne</span><span class="PUNC">,</span><span class="NAME">sw</span><span class="PUNC">,</span><span class="NAME">se</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">rgba</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">rgba</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">rgba</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">rgba</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">&lt;</span><span class="NAME">outputData.length</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">outputData</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.convolute</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_weights</span><span class="PUNC">,</span><span class="NAME">p_opaque</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">side</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">p_weights.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">halfSide</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">side</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sw</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sh</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">sh</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">=</span><span class="NAME">Filter.createImageData</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dst</span><span class="PUNC">=</span><span class="NAME">output.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alphaFac</span><span class="PUNC">=</span><span class="NAME">p_opaque</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dstOff</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cy</span><span class="PUNC">&lt;</span><span class="NAME">side</span><span class="PUNC">;</span><span class="NAME">cy</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">&lt;</span><span class="NAME">side</span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scy</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sh</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sy</span><span class="PUNC">+</span><span class="NAME">cy</span><span class="PUNC">-</span><span class="NAME">halfSide</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scx</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sw</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sx</span><span class="PUNC">+</span><span class="NAME">cx</span><span class="PUNC">-</span><span class="NAME">halfSide</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcOff</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">scy</span><span class="PUNC">*</span><span class="NAME">sw</span><span class="PUNC">+</span><span class="NAME">scx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wt</span><span class="PUNC">=</span><span class="NAME">p_weights</span><span class="PUNC">[</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">side</span><span class="PUNC">+</span><span class="NAME">cx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">r</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">+</span><span class="NAME">alphaFac</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">255</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.convoluteFloat32</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_pixels</span><span class="PUNC">,</span><span class="NAME">p_weights</span><span class="PUNC">,</span><span class="NAME">p_opaque</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.Float32Array</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Float32Array</span><span class="PUNC">=</span><span class="NAME">Array</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">side</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">p_weights.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">halfSide</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">side</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">p_pixels.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sw</span><span class="PUNC">=</span><span class="NAME">p_pixels.width</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sh</span><span class="PUNC">=</span><span class="NAME">p_pixels.height</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">sw</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">sh</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">:</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Float32Array</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dst</span><span class="PUNC">=</span><span class="NAME">output.data</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">alphaFac</span><span class="PUNC">=</span><span class="NAME">p_opaque</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">w</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dstOff</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">w</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cy</span><span class="PUNC">&lt;</span><span class="NAME">side</span><span class="PUNC">;</span><span class="NAME">cy</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">&lt;</span><span class="NAME">side</span><span class="PUNC">;</span><span class="NAME">cx</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scy</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sh</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sy</span><span class="PUNC">+</span><span class="NAME">cy</span><span class="PUNC">-</span><span class="NAME">halfSide</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scx</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sw</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">sx</span><span class="PUNC">+</span><span class="NAME">cx</span><span class="PUNC">-</span><span class="NAME">halfSide</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">srcOff</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">scy</span><span class="PUNC">*</span><span class="NAME">sw</span><span class="PUNC">+</span><span class="NAME">scx</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wt</span><span class="PUNC">=</span><span class="NAME">p_weights</span><span class="PUNC">[</span><span class="NAME">cy</span><span class="PUNC">*</span><span class="NAME">side</span><span class="PUNC">+</span><span class="NAME">cx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">r</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">src</span><span class="PUNC">[</span><span class="NAME">srcOff</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">wt</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">dst</span><span class="PUNC">[</span><span class="NAME">dstOff</span><span class="PUNC">+</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">+</span><span class="NAME">alphaFac</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">255</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">output</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.multiplyPixels</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_topValue</span><span class="PUNC">,</span><span class="NAME">p_bottomValue</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_topValue</span><span class="PUNC">*</span><span class="NAME">p_bottomValue</span><span class="PUNC">/</span><span class="NUMB">255</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.createImageData</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_w</span><span class="PUNC">,</span><span class="NAME">p_h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_tmpCanvas</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_tmpCtx</span><span class="PUNC">=</span><span class="NAME">_tmpCanvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_tmpCtx.createImageData</span><span class="PUNC">(</span><span class="NAME">p_w</span><span class="PUNC">,</span><span class="NAME">p_h</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Filter.tableFilter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inputData</span><span class="PUNC">,</span><span class="NAME">table</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">height</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">width</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pixel</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">width</span><span class="PUNC">+</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">table</span><span class="PUNC">[</span><span class="NAME">inputData</span><span class="PUNC">[</span><span class="NAME">pixel</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.Filter</span><span class="PUNC">=</span><span class="NAME">Filter</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">DisplayObject</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">DisplayObject.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">DisplayObject</span><span class="PUNC">;</span><span class="NAME">a.x</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._x</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"x"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._x</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.y</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._y</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"y"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._y</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.width</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._width</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"width"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._width</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.height</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._height</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"height"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._height</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._scale</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"scale"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._scale</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.rotate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._rotate</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"rotate"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._rotate</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.filter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">!=</span><span class="NAME">undefined</span><span class="PUNC">&&</span><span class="NAME">arguments.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.resetFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._filters</span><span class="PUNC">=</span><span class="NAME">this._filters</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">d.args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">d.effect</span><span class="PUNC">=</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d.args.push</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this._filters</span><span class="PUNC">[</span><span class="NAME">d.effect</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"filter"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._filters</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.filterRemove</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">===</span><span class="NAME">e</span><span class="PUNC">||</span><span class="NAME">c</span><span class="PUNC">===</span><span class="STRN">"all"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.resetFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.unbind</span><span class="PUNC">(</span><span class="STRN">"finishDraw"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.resetFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Util.getSize</span><span class="PUNC">(</span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._filters</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"filterRemove"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">===</span><span class="STRN">"all"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._filters</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.resetFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"filterRemove"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.bind</span><span class="PUNC">(</span><span class="STRN">"finishDraw"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.collides</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">d.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">c.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">d.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">d.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">c.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">d.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NAME">c.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">c.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">d.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">d.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">c.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.resetFilter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.filter_cache</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.drag</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.on</span><span class="PUNC">(</span><span class="STRN">"drag"</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._cleartrace</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._trace_canvas</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._trace_canvas.canvas.width</span><span class="PUNC">=</span><span class="NAME">this._trace_canvas.canvas.width</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._transform_reset</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.DisplayObject</span><span class="PUNC">=</span><span class="NAME">DisplayObject</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Loop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_canvas.bind</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">||</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Loop.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Loop</span><span class="PUNC">;</span><span class="NAME">b.Loop</span><span class="PUNC">=</span><span class="NAME">Loop</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Transform</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.stack</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Transform.prototype</span><span class="PUNC">;</span><span class="NAME">a.setContext</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.getMatrix</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.matrix</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.setMatrix</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.matrix</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.cloneMatrix</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.save</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.cloneMatrix</span><span class="PUNC">(</span><span class="NAME">this.getMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.stack.push</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.context.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.restore</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.stack.length</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.stack.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setMatrix</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.context.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.setTransform</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.context.setTransform</span><span class="PUNC">(</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.translate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.rotate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">j</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">j</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">j</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.scale</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.rotateDegrees</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">;</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.rotateAbout</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.rotateDegreesAbout</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.rotateDegrees</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.translate</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.identity</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.matrix</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.multiply</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">e.m</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.invert</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">j</span><span class="PUNC">;</span><span class="NAME">this.setTransform</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.transformPoint</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">this.matrix</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.Transform</span><span class="PUNC">=</span><span class="NAME">Transform</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Events</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b.$$_EVENTS_CHILDREN</span><span class="PUNC">=</span><span class="NAME">b.$$_EVENTS_CHILDREN</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">b.$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">=</span><span class="NAME">b.$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Events.prototype</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Events</span><span class="PUNC">;</span><span class="NAME">a.on</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_EVENTS_CHILDREN.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">object</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">event</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.Events</span><span class="PUNC">=</span><span class="NAME">Events</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Bitmap</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Events</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Animate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._lastDrawState</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Bitmap.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DisplayObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Bitmap</span><span class="PUNC">;</span><span class="NAME">a.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.src</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._src</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this._loadsrc</span><span class="PUNC">(</span><span class="NAME">this._src</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._src</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.draw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._transform_reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"beginDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_trace</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">this._src</span><span class="PUNC">,</span><span class="STRN">"initial"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_basic</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_filters</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.mask</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_mask</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.transform.context.drawImage</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._lastDrawState</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.transform.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"finishDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._handle_mask</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._mask_canvas</span><span class="PUNC">=</span><span class="NAME">this._mask_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"mask_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform</span><span class="PUNC">=</span><span class="NAME">this._mask_transform</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._mask_canvas.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_canvas.context.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this._mask_canvas.canvas.width</span><span class="PUNC">,</span><span class="NAME">this._mask_canvas.canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyStroke</span><span class="PUNC">(</span><span class="NAME">this._mask_transform.context</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_transform.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.mask</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">_make</span><span class="PUNC">(</span><span class="NAME">this._mask_canvas.context</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._mask_canvas.canvas</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.toDataURL</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._dataurl_canvas</span><span class="PUNC">=</span><span class="NAME">this._dataurl_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"dataurl_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_transform</span><span class="PUNC">=</span><span class="NAME">this._dataurl_transform</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._dataurl_canvas.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._dataurl_canvas.canvas.width</span><span class="PUNC">=</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_canvas.canvas.height</span><span class="PUNC">=</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this._dataurl_transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_canvas.context.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this._dataurl_canvas.canvas.width</span><span class="PUNC">,</span><span class="NAME">this._dataurl_canvas.canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this._dataurl_transform.getMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._dataurl_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">b.$$_canvas.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._dataurl_transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_transform.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this._dataurl_transform.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._dataurl_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">this._lastDrawState</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._dataurl_canvas.canvas.toDataURL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.mouseDraw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._mouse_canvas</span><span class="PUNC">=</span><span class="NAME">this._mouse_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"mouse_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform</span><span class="PUNC">=</span><span class="NAME">this._mouse_transform</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._mouse_canvas.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this._mouse_canvas.canvas.width</span><span class="PUNC">,</span><span class="NAME">this._mouse_canvas.canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._mouse_transform.getMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this._mouse_transform.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">this._src</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._mouse_canvas.context</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.trace</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">===</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._cleartrace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._trace</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"trace"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._trace</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._loadsrc</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d.src</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">d.onload</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f.orig_width</span><span class="PUNC">=</span><span class="NAME">d.width</span><span class="PUNC">;</span><span class="NAME">f.orig_height</span><span class="PUNC">=</span><span class="NAME">d.height</span><span class="PUNC">;</span><span class="NAME">f.width</span><span class="PUNC">(</span><span class="NAME">f.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">d.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">f.height</span><span class="PUNC">(</span><span class="NAME">f.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">d.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">f._src</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">f.visible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f.dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">f.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"_loadsrc"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">f.bind</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">,</span><span class="NAME">f.draw</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">f.ready</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">f.fire</span><span class="PUNC">(</span><span class="STRN">"loaded"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._handle_filters</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.filter_cache</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._filter_canvas</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Util.removeElement</span><span class="PUNC">(</span><span class="NAME">this._filter_canvas.canvas.id</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this._filter_canvas</span><span class="PUNC">=</span><span class="NAME">this._filter_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"filter_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._filter_canvas.canvas.width</span><span class="PUNC">=</span><span class="NAME">this.orig_width</span><span class="PUNC">;</span><span class="NAME">this._filter_canvas.canvas.height</span><span class="PUNC">=</span><span class="NAME">this.orig_height</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._filter_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._filter_canvas.context.drawImage</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">Filter.get</span><span class="PUNC">(</span><span class="NAME">this._filter_canvas</span><span class="PUNC">,</span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.filter_cache</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.filter_cache</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.filter_cache</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this.filter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this._handle_trace</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="STRN">"filter"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._handle_trace</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"trace_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"trace_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"trace_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"trace_transfrom_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">e.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"trace_transfrom_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">g.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g.scale</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyStroke</span><span class="PUNC">(</span><span class="NAME">e.context</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">this.orig_width</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">this.orig_height</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">g.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e.context.drawImage</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.canvas</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._handle_basic</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyStroke</span><span class="PUNC">(</span><span class="NAME">this.transform.context</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.scale</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this.transform.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._src</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.name</span><span class="PUNC">=</span><span class="STRN">"Bitmap Instance"</span><span class="PUNC">;</span><span class="NAME">b.Bitmap</span><span class="PUNC">=</span><span class="NAME">Bitmap</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Path</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._paths</span><span class="PUNC">=</span><span class="NAME">this._paths</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this._context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.transform</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._context</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Path.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Path</span><span class="PUNC">;</span><span class="NAME">a.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.bind</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">,</span><span class="NAME">this.draw</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.width</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._width</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._width</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.color</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._color</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._color</span><span class="PUNC">||</span><span class="STRN">"#000"</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.beginPath</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._p_startX</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this._p_startY</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.style</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c.width</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="NAME">c.width</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c.color</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.color</span><span class="PUNC">(</span><span class="NAME">c.color</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.to</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._paths.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.end</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._end</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._end</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.draw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.context.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.context.moveTo</span><span class="PUNC">(</span><span class="NAME">this._p_startX</span><span class="PUNC">,</span><span class="NAME">this._p_startY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">this._paths.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._paths</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.context.lineTo</span><span class="PUNC">(</span><span class="NAME">this._paths</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">this._paths</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this.transform.context.strokeStyle</span><span class="PUNC">=</span><span class="NAME">this.color</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">"#000"</span><span class="PUNC">;</span><span class="NAME">this.transform.context.lineWidth</span><span class="PUNC">=</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this.transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this.transform.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.end</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.transform.context.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.transform.context.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.name</span><span class="PUNC">=</span><span class="STRN">"Path Instance"</span><span class="PUNC">;</span><span class="NAME">b.Path</span><span class="PUNC">=</span><span class="NAME">Path</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Sprite</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Events</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Animate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.controller</span><span class="PUNC">=</span><span class="NAME">$$_canvas</span><span class="PUNC">;</span><span class="NAME">this.iterate</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this._sequences</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this._curSequence</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this._lastDrawState</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Sprite.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Bitmap</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Sprite</span><span class="PUNC">;</span><span class="NAME">a.src</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">&&</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Util.getJSON</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._src</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.frames</span><span class="PUNC">=</span><span class="NAME">e.frames</span><span class="PUNC">;</span><span class="NAME">this._curSequence</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">start</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">end</span><span class="PUNC">:</span><span class="NAME">this.frames.length</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">this._loadsrc</span><span class="PUNC">(</span><span class="NAME">this._src</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._src</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.draw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._transform_reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"beginDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_sprite</span><span class="PUNC">(</span><span class="NAME">this._src</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.trace</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_trace</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="STRN">"initial"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._handle_basic</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">this.resetFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._handle_filters</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.context.drawImage</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._lastDrawState</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this.transform.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"finishDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._handle_sprite</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this._sprite_canvas</span><span class="PUNC">=</span><span class="NAME">this._sprite_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"sprite_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">&lt;=</span><span class="NAME">this._curSequence.end</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.gotoAndStop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.iterate</span><span class="PUNC">=</span><span class="NAME">this.gotoAndStop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.iterate</span><span class="PUNC">++</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.iterate</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame.w</span><span class="PUNC">+</span><span class="NAME">this.padding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.iterate</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame.h</span><span class="PUNC">+</span><span class="NAME">this.padding</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.iterate</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame.x</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.iterate</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame.y</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this._sprite_canvas.context</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this._sprite_canvas.canvas</span><span class="PUNC">;</span><span class="NAME">c.width</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">c.height</span><span class="PUNC">=</span><span class="NAME">j</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._src_sprite</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._src_sprite</span><span class="PUNC">=</span><span class="NAME">this._src</span><span class="PUNC">;</span><span class="NAME">this._src</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="NAME">e.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">c.width</span><span class="PUNC">,</span><span class="NAME">c.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">e.drawImage</span><span class="PUNC">(</span><span class="NAME">this._src_sprite</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">g</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">===</span><span class="NAME">this._curSequence.end</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">this.loop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.iterate</span><span class="PUNC">=</span><span class="NAME">this._curSequence.start</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">===</span><span class="NAME">this._curSequence.end</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"spriteFinished"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.loop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._loop</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._loop</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.padding</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._padding</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._padding</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.gotoAndStop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">===</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="NAME">this._sequences</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">end</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this._curSequenceName</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="NAME">this.controller.childrenDraw</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._stopindex</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.gotoAndPlay</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">===</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.run</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">this.iterate</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.controller.childrenDraw</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._stopindex</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.nextFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">!=</span><span class="NAME">this.frames.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.gotoAndStop</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.prevFrame</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.iterate</span><span class="PUNC">>=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">this.iterate</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">this.gotoAndStop</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.sequence</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._sequences</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">start</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">end</span><span class="PUNC">:</span><span class="NAME">e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.run</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._curSequenceName</span><span class="PUNC">!=</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._sequences</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">d.start</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">d.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d.end</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">d.end</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._curSequence</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">this._stopindex</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._curSequence.start</span><span class="PUNC">!=</span><span class="NAME">this._sequences</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">start</span><span class="PUNC">||</span><span class="NAME">this._curSequence.start</span><span class="PUNC">===</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.iterate</span><span class="PUNC">=</span><span class="NAME">d.start</span><span class="PUNC">;</span><span class="NAME">this._curSequenceName</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.loop</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this.controller.childrenDraw</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.name</span><span class="PUNC">=</span><span class="STRN">"Sprite Instance"</span><span class="PUNC">;</span><span class="NAME">b.Sprite</span><span class="PUNC">=</span><span class="NAME">Sprite</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Shape</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Shape.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DisplayObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Shape</span><span class="PUNC">;</span><span class="NAME">a.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ready</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.bind</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">,</span><span class="NAME">this.draw</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._make</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.name</span><span class="PUNC">=</span><span class="STRN">"Shape Instance"</span><span class="PUNC">;</span><span class="NAME">b.Shape</span><span class="PUNC">=</span><span class="NAME">Shape</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Rectangle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Events</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Animate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx</span><span class="PUNC">=</span><span class="NAME">this.transform.context</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Rectangle.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Shape</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Rectangle</span><span class="PUNC">;</span><span class="NAME">a.draw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._transform_reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"beginDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.scale</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this.ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.fillStyle</span><span class="PUNC">=</span><span class="NAME">this.color</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.quadraticCurveTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.quadraticCurveTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.quadraticCurveTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.quadraticCurveTo</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.transform.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"finishDraw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._make</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">c.moveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.lineTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.quadraticCurveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.lineTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.quadraticCurveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.lineTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.quadraticCurveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.lineTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.quadraticCurveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NAME">this.radius</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.clip</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.mouseDraw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._mouse_canvas</span><span class="PUNC">=</span><span class="NAME">this._mouse_canvas</span><span class="PUNC">||</span><span class="NAME">Util.createContext</span><span class="PUNC">(</span><span class="STRN">"mouse_"</span><span class="PUNC">+</span><span class="NAME">this.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform</span><span class="PUNC">=</span><span class="NAME">this._mouse_transform</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Transform</span><span class="PUNC">(</span><span class="NAME">this._mouse_canvas.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.setMatrix</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this._mouse_canvas.canvas.width</span><span class="PUNC">,</span><span class="NAME">this._mouse_canvas.canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.translate</span><span class="PUNC">(</span><span class="NAME">this.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">this._mouse_transform.getMatrix</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.rotate</span><span class="PUNC">(</span><span class="NAME">this.rotate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_width</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.orig_height</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.scale</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_transform.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._applyShadow</span><span class="PUNC">(</span><span class="NAME">this._mouse_transform.context</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.fillStyle</span><span class="PUNC">=</span><span class="NAME">this.color</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.globalAlpha</span><span class="PUNC">=</span><span class="NAME">this.alpha</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mouse_canvas.context.fillRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.width</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.height</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._mouse_canvas.context</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.color</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._color</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">arguments.callee.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._color</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.radius</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._radius</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._radius</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.name</span><span class="PUNC">=</span><span class="STRN">"Rectangle Instance"</span><span class="PUNC">;</span><span class="NAME">b.Rectangle</span><span class="PUNC">=</span><span class="NAME">Rectangle</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">FrameTicker</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.timerID</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">this.timers</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">FrameTicker.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">FrameTicker</span><span class="PUNC">;</span><span class="NAME">a.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b.requestAnimFrame</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.requestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">b.webkitRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">b.mozRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">b.oRequestAnimationFrame</span><span class="PUNC">||</span><span class="NAME">b.msRequestAnimationFrame</span><span class="PUNC">||</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b.setTimeout</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NUMB">1000</span><span class="PUNC">/</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.start</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.timerID</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">arguments.callee</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d.on</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d._requestTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d.fire</span><span class="PUNC">(</span><span class="STRN">"tick"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d.timerID</span><span class="PUNC">=</span><span class="NAME">b.requestAnimFrame</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.stop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._requestTimeout</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">b.requestAnimationFrame</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">b.webkitRequestAnimationFrame</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">b.mozRequestAnimationFrame</span><span class="PUNC">&&</span><span class="NAME">b.mozCancelRequestAnimationFrame</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">b.oRequestAnimationFrame</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">b.msRequestAnimationFrame</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b.setTimeout</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">>=</span><span class="NAME">d</span><span class="PUNC">?</span><span class="NAME">e.call</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">f.value</span><span class="PUNC">=</span><span class="NAME">requestAnimFrame</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">f.value</span><span class="PUNC">=</span><span class="NAME">requestAnimFrame</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.FrameTicker</span><span class="PUNC">=</span><span class="NAME">FrameTicker</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Tweenie</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_scope</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Tween_runner</span><span class="PUNC">(</span><span class="NAME">p_tween</span><span class="PUNC">,</span><span class="NAME">p_home</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.on</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="NAME">this.tween</span><span class="PUNC">=</span><span class="NAME">p_tween</span><span class="PUNC">;</span><span class="NAME">this.id</span><span class="PUNC">=</span><span class="NAME">p_tween.what.id</span><span class="PUNC">;</span><span class="NAME">this._home</span><span class="PUNC">=</span><span class="NAME">p_home</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_this</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">elapsed</span><span class="PUNC">,</span><span class="NAME">ease_val</span><span class="PUNC">,</span><span class="NAME">c_time</span><span class="PUNC">,</span><span class="NAME">calculation</span><span class="PUNC">,</span><span class="NAME">obj_delta</span><span class="PUNC">;</span><span class="NAME">c_time</span><span class="PUNC">=</span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">p_tween</span><span class="PUNC">;</span><span class="NAME">obj.what._animating</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj.props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">elapsed</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">c_time</span><span class="PUNC">-</span><span class="NAME">obj.start_time</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">obj.duration</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">elapsed</span><span class="PUNC">=</span><span class="NAME">elapsed</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">elapsed</span><span class="PUNC">;</span><span class="NAME">ease_val</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"Easing."</span><span class="PUNC">+</span><span class="NAME">obj.easing</span><span class="PUNC">+</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">elapsed</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">calculation</span><span class="PUNC">=</span><span class="NAME">obj.distance</span><span class="PUNC">[</span><span class="STRN">"start_"</span><span class="PUNC">+</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">obj.distance</span><span class="PUNC">[</span><span class="STRN">"delta_"</span><span class="PUNC">+</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">ease_val</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elapsed</span><span class="PUNC">!=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj.what</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">calculation</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj.callback</span><span class="PUNC">&&</span><span class="NAME">elapsed</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_this.on</span><span class="PUNC">==</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">obj.callback.call</span><span class="PUNC">(</span><span class="NAME">obj.what</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_this.fire</span><span class="PUNC">(</span><span class="STRN">"finished"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">obj.what._animating</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">_this.on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">obj.update</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">obj.props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj.what</span><span class="PUNC">[</span><span class="NAME">p</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="NAME">obj.update.call</span><span class="PUNC">(</span><span class="NAME">obj.what</span><span class="PUNC">,</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">elapsed</span><span class="PUNC">===</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_this.fire</span><span class="PUNC">(</span><span class="STRN">"finished"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_this.on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="NAME">obj.what._animating</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_this.on</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_this.timerID</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">arguments.callee</span><span class="PUNC">,</span><span class="NAME">$$_canvas.framerate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">_this.fire</span><span class="PUNC">(</span><span class="STRN">"finished"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">obj.what._animating</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_pt</span><span class="PUNC">=</span><span class="NAME">Tween_runner.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_pt</span><span class="PUNC">=</span><span class="NAME">Tweenie.prototype</span><span class="PUNC">;</span><span class="NAME">_pt._tweens</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">_pt.to</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_what</span><span class="PUNC">,</span><span class="NAME">p_props</span><span class="PUNC">,</span><span class="NAME">p_time</span><span class="PUNC">,</span><span class="NAME">p_easing</span><span class="PUNC">,</span><span class="NAME">p_update</span><span class="PUNC">,</span><span class="NAME">p_callback</span><span class="PUNC">,</span><span class="NAME">p_delay</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_temp_id</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="STRN">"id_"</span><span class="PUNC">+</span><span class="NAME">p_what.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._tweens.hasOwnProperty</span><span class="PUNC">(</span><span class="STRN">"id_"</span><span class="PUNC">+</span><span class="NAME">p_what.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._tweens</span><span class="PUNC">[</span><span class="NAME">_temp_id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta_start</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p_props</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">delta_start</span><span class="PUNC">[</span><span class="STRN">"start_"</span><span class="PUNC">+</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">p_what</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">delta_start</span><span class="PUNC">[</span><span class="STRN">"delta_"</span><span class="PUNC">+</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">p_props</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">p_what</span><span class="PUNC">[</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_start_time</span><span class="PUNC">=</span><span class="NAME">Date.now</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">p_delay</span><span class="PUNC">?</span><span class="NAME">p_delay</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">temp_tween</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Tween_runner</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">what</span><span class="PUNC">:</span><span class="NAME">p_what</span><span class="PUNC">,</span><span class="NAME">start_time</span><span class="PUNC">:</span><span class="NAME">_start_time</span><span class="PUNC">,</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="NAME">p_time</span><span class="PUNC">,</span><span class="NAME">easing</span><span class="PUNC">:</span><span class="NAME">p_easing</span><span class="PUNC">,</span><span class="NAME">props</span><span class="PUNC">:</span><span class="NAME">p_props</span><span class="PUNC">,</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">delta_start</span><span class="PUNC">,</span><span class="NAME">update</span><span class="PUNC">:</span><span class="NAME">p_update</span><span class="PUNC">,</span><span class="NAME">callback</span><span class="PUNC">:</span><span class="NAME">p_callback</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._tweens</span><span class="PUNC">[</span><span class="NAME">_temp_id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">temp_tween</span><span class="PUNC">;</span><span class="NAME">temp_tween.bind</span><span class="PUNC">(</span><span class="STRN">"finished"</span><span class="PUNC">,</span><span class="NAME">this._cleanup</span><span class="PUNC">,</span><span class="NAME">temp_tween</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.stop</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_what</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_what.id</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this._tweens.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._tweens</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">==</span><span class="NAME">p_what.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._tweens</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt._cleanup</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_obj</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_tweens</span><span class="PUNC">=</span><span class="NAME">this._home._tweens</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_tweens</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_tweens.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_tweens</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">==</span><span class="NAME">this.id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_tweens</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">Linear</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Quadratic</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Cubic</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Quartic</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Quintic</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Sinusoidal</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Exponential</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Circular</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Elastic</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Back</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">Bounce</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Linear.EaseNone</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.none</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quadratic.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quadratic.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quadratic.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Cubic.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Cubic.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Cubic.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quartic.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quartic.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">(</span><span class="PUNC">--</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quartic.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quintic.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quintic.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">=</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Quintic.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Sinusoidal.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Sinusoidal.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Sinusoidal.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Exponential.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Exponential.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Exponential.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Circular.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Circular.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">--</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Circular.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Elastic.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.3</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">||</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.asin</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Elastic.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.3</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">||</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.asin</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Elastic.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.4</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p</span><span class="PUNC">=</span><span class="NUMB">0.3</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">||</span><span class="NAME">a</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">s</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.asin</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">*</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Back.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NUMB">1.70158</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Back.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NUMB">1.70158</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">=</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Back.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">=</span><span class="NUMB">1.70158</span><span class="PUNC">*</span><span class="NUMB">1.525</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Bounce.EaseIn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">Easing.Bounce.EaseOut</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Bounce.EaseOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">/</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">7.5625</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">7.5625</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1.5</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">0.75</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NUMB">2.5</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">7.5625</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">2.25</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">0.9375</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">7.5625</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">2.625</span><span class="PUNC">/</span><span class="NUMB">2.75</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">p_e</span><span class="PUNC">+</span><span class="NUMB">0.984375</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">Easing.Bounce.EaseInOut</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">&lt;</span><span class="NUMB">0.5</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Easing.Bounce.EaseIn</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Easing.Bounce.EaseOut</span><span class="PUNC">(</span><span class="NAME">p_e</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">0.5</span><span class="PUNC">+</span><span class="NUMB">0.5</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.Easing</span><span class="PUNC">=</span><span class="NAME">Easing</span><span class="PUNC">;</span><span class="NAME">window.Tweenie</span><span class="PUNC">=</span><span class="NAME">Tweenie</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Canvas</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">EventTarget.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._canvas</span><span class="PUNC">=</span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._canvas.width</span><span class="PUNC">=</span><span class="NAME">this.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">b.innerWidth</span><span class="PUNC">;</span><span class="NAME">this._canvas.height</span><span class="PUNC">=</span><span class="NAME">this.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">b.innerHeight</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._canvas</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this._canvas.getContext</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">throw</span><span class="STRN">"No Canvas Support."</span><span class="PUNC">}</span><span class="NAME">this.context</span><span class="PUNC">(</span><span class="NAME">this._canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.context</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">translate</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.framerate</span><span class="PUNC">(</span><span class="NAME">this.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"framerate"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._engine</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">FrameTicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._engine.start</span><span class="PUNC">(</span><span class="NAME">this.framerate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="STRN">"tick"</span><span class="PUNC">,</span><span class="NAME">this.childrenDraw</span><span class="PUNC">,</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">Canvas.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">EventTarget</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a.constructor</span><span class="PUNC">=</span><span class="NAME">Canvas</span><span class="PUNC">;</span><span class="NAME">a.init</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">HTMLCanvasElement.prototype.relMouseCoords</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">totalOffsetY</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">canvasX</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">canvasY</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">currentElement</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">do</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">currentElement.offsetLeft</span><span class="PUNC">;</span><span class="NAME">totalOffsetY</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">currentElement.offsetTop</span><span class="PUNC">}</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="NAME">currentElement</span><span class="PUNC">=</span><span class="NAME">currentElement.offsetParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">canvasX</span><span class="PUNC">=</span><span class="NAME">d.pageX</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">canvasY</span><span class="PUNC">=</span><span class="NAME">d.pageY</span><span class="PUNC">-</span><span class="NAME">totalOffsetY</span><span class="PUNC">;</span><span class="NAME">canvasX</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">canvasX</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">/</span><span class="NAME">this.offsetWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">canvasY</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">canvasY</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">/</span><span class="NAME">this.offsetHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">canvasX</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">canvasY</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">document.addEventListener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">document.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._MouseUpHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._MouseMoveHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.addEventListener</span><span class="PUNC">(</span><span class="STRN">"onkeydown"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">document.onkeydown</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">;</span><span class="NAME">document.onkeypress</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">;</span><span class="NAME">document.onkeyup</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.addEventListener</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._MouseUpHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._MouseMoveHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.addEventListener</span><span class="PUNC">(</span><span class="STRN">"onkeydown"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b.onkeydown</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">;</span><span class="NAME">b.onkeypress</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">;</span><span class="NAME">b.onkeyup</span><span class="PUNC">=</span><span class="NAME">c._keyDownHandler</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">this._canvas.addEventListener</span><span class="PUNC">(</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c._MouseDownHandler</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.width</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._width</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._width</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.height</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._height</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._height</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.framerate</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._framerate</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._framerate</span><span class="PUNC">||</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.context</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._context</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._context</span><span class="PUNC">||</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.canvas</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._canvas</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._canvas</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a.childrenDraw</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this._isDirty</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!==</span><span class="KEYW">true</span><span class="PUNC">&&</span><span class="NAME">d</span><span class="PUNC">!=</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="NAME">this.context</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">clearRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this._canvas.width</span><span class="PUNC">,</span><span class="NAME">this._canvas.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">$$_CHILDREN.length</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">visible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fire</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dirty</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._isDirty</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">$$_CHILDREN.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_CHILDREN</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dirty</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">===</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._keyDownHandler</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_CHILDREN.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="NAME">c.type</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._MouseDownHandler</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">relMouseCoords</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">e.x</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">e.y</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_CHILDREN.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="STRN">"click"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Util.checkPIXEL</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="STRN">"drag"</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_obj"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Util.checkPIXEL</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object.id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_obj"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">c.clickX</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">c.clickY</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">c.pastX</span><span class="PUNC">=</span><span class="NAME">c.object.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c.pastY</span><span class="PUNC">=</span><span class="NAME">c.object.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">eventType</span><span class="PUNC">:</span><span class="STRN">"onStart"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._MouseUpHandler</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="STRN">"drag"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">eventType</span><span class="PUNC">:</span><span class="STRN">"onFinished"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">a._MouseMoveHandler</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">this.canvas</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">relMouseCoords</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">f.x</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">f.y</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_CHILDREN.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">--</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="STRN">"hover"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Util.checkPIXEL</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">j</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_CHILDREN</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">event</span><span class="PUNC">===</span><span class="STRN">"drag"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">j</span><span class="PUNC">-</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">k.pastX</span><span class="PUNC">-</span><span class="NAME">k.clickX</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">k.pastY</span><span class="PUNC">-</span><span class="NAME">k.clickY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k.object.x</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k.object.y</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$$_EVENTS_DRAG_CHILDREN</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback.call</span><span class="PUNC">(</span><span class="NAME">k.object</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">eventType</span><span class="PUNC">:</span><span class="STRN">"onUpdate"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k.clickX</span><span class="PUNC">=</span><span class="NAME">j</span><span class="PUNC">;</span><span class="NAME">k.clickY</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">k.pastX</span><span class="PUNC">=</span><span class="NAME">k.object.x</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k.pastY</span><span class="PUNC">=</span><span class="NAME">k.object.y</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.Canvas</span><span class="PUNC">=</span><span class="NAME">Canvas</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">Element</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_class</span><span class="PUNC">,</span><span class="NAME">p_def</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_class</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">window.$$_CHILDREN</span><span class="PUNC">=</span><span class="NAME">window.$$_CHILDREN</span><span class="PUNC">||</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="NAME">window.$$_CHILDREN_ID</span><span class="PUNC">=</span><span class="NAME">window.$$_CHILDREN_ID</span><span class="PUNC">||</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">window.$$_TWEENS</span><span class="PUNC">=</span><span class="NAME">window.$$_TWEENS</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.$$_canvas</span><span class="PUNC">=</span><span class="NAME">window.$$_canvas</span><span class="PUNC">||</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Canvas</span><span class="PUNC">(</span><span class="NAME">this.canvas_id</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="STRN">"element-root"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_temp</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"new "</span><span class="PUNC">+</span><span class="NAME">p_class</span><span class="PUNC">+</span><span class="STRN">"(window.$$_canvas.context())"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp</span><span class="PUNC">=</span><span class="NAME">this.extend</span><span class="PUNC">(</span><span class="NAME">_temp</span><span class="PUNC">,</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Element</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp.id</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">window.$$_CHILDREN_ID</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp.index</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">window.$$_CHILDREN_ID</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp.visible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp.alpha</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_temp._tweenie</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Tweenie</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">_temp.init</span><span class="PUNC">===</span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_temp.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">window.$$_CHILDREN.push</span><span class="PUNC">(</span><span class="NAME">_temp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">window.$$_CHILDREN_ID</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="NAME">_temp._handelDefinition</span><span class="PUNC">(</span><span class="NAME">p_def</span><span class="PUNC">,</span><span class="NAME">_temp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_temp</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_pt</span><span class="PUNC">=</span><span class="NAME">Element.prototype</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Basic</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_pt.alpha</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._alpha</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"alpha"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._alpha</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.visible</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._visible</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._visible</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.mask</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p_val.alpha</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">p_val.unbind</span><span class="PUNC">(</span><span class="STRN">"draw"</span><span class="PUNC">,</span><span class="NAME">p_val.draw</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this._mask</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"mask"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._mask</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.id</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._id</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.canvas_id</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._id</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._id</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.index</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._index</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._index</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.ready</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._ready</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._ready</span><span class="PUNC">||</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.shadow</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._shadow</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"shadow"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._shadow</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.border</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_val</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._border</span><span class="PUNC">=</span><span class="NAME">p_val</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"border"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._border</span><span class="PUNC">||</span><span class="PUNC">{</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.top</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_i</span><span class="PUNC">=</span><span class="NAME">Util.getIndex</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_childtotop</span><span class="PUNC">=</span><span class="NAME">$$_CHILDREN.splice</span><span class="PUNC">(</span><span class="NAME">_i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$$_CHILDREN.push</span><span class="PUNC">(</span><span class="NAME">_childtotop</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"top"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.bottom</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_i</span><span class="PUNC">=</span><span class="NAME">Util.getIndex</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_childtotop</span><span class="PUNC">=</span><span class="NAME">$$_CHILDREN.splice</span><span class="PUNC">(</span><span class="NAME">_i</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">$$_CHILDREN.unshift</span><span class="PUNC">(</span><span class="NAME">_childtotop</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">this.dirty</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="STRN">"bottom"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt.toString</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="STRN">"["</span><span class="PUNC">+</span><span class="NAME">this.name</span><span class="PUNC">+</span><span class="STRN">" Instance]"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt._applyStroke</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_context</span><span class="PUNC">,</span><span class="NAME">p_cords</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.border</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">color</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_c</span><span class="PUNC">=</span><span class="NAME">p_context</span><span class="PUNC">,</span><span class="NAME">_b</span><span class="PUNC">=</span><span class="NAME">this.border</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">loc</span><span class="PUNC">=</span><span class="NAME">p_cords</span><span class="PUNC">;</span><span class="NAME">_c.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_c.rect</span><span class="PUNC">(</span><span class="NAME">loc.x</span><span class="PUNC">,</span><span class="NAME">loc.y</span><span class="PUNC">,</span><span class="NAME">loc.w</span><span class="PUNC">,</span><span class="NAME">loc.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_c.strokeStyle</span><span class="PUNC">=</span><span class="NAME">_b.color</span><span class="PUNC">;</span><span class="NAME">_c.lineWidth</span><span class="PUNC">=</span><span class="NAME">_b.width</span><span class="PUNC">;</span><span class="NAME">_c.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_c.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt._applyShadow</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.shadow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">color</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_c</span><span class="PUNC">=</span><span class="NAME">p_context</span><span class="PUNC">,</span><span class="NAME">_s</span><span class="PUNC">=</span><span class="NAME">this.shadow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">_color</span><span class="PUNC">=</span><span class="NAME">Util.hexToRGB</span><span class="PUNC">(</span><span class="NAME">_s.color</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">_c.shadowColor</span><span class="PUNC">=</span><span class="STRN">"rgba("</span><span class="PUNC">+</span><span class="NAME">_color.r</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">_color.b</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="NAME">_color.g</span><span class="PUNC">+</span><span class="STRN">", "</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">_s.alpha</span><span class="PUNC">||</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">;</span><span class="NAME">_c.shadowBlur</span><span class="PUNC">=</span><span class="NAME">_s.blur</span><span class="PUNC">;</span><span class="NAME">_c.shadowOffsetX</span><span class="PUNC">=</span><span class="NAME">_s.x</span><span class="PUNC">;</span><span class="NAME">_c.shadowOffsetY</span><span class="PUNC">=</span><span class="NAME">_s.y</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">_pt._handelDefinition</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p_def</span><span class="PUNC">,</span><span class="NAME">p_ele</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">p_def</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_multi_func</span><span class="PUNC">,</span><span class="NAME">_args</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">_f</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prop</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p_def</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">prop</span><span class="PUNC">===</span><span class="STRN">"filter"</span><span class="PUNC">||</span><span class="NAME">prop</span><span class="PUNC">===</span><span class="STRN">"sequence"</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_multi_func</span><span class="PUNC">=</span><span class="NAME">p_def</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">_multi_func.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">_args</span><span class="PUNC">=</span><span class="NAME">_multi_func</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_args.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p_ele</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">p_ele</span><span class="PUNC">,</span><span class="NAME">_args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">p_ele</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">_multi_func</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">_args</span><span class="PUNC">=</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">p_def</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">?</span><span class="NAME">p_def</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">p_def</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">_args.length</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">p_ele</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">p_ele</span><span class="PUNC">,</span><span class="NAME">_args</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">else</span><span class="PUNC">{</span><span class="NAME">p_ele</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">p_def</span><span class="PUNC">[</span><span class="NAME">prop</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.Element</span><span class="PUNC">=</span><span class="NAME">Element</span><span class="PUNC">}</span><span class="PUNC">(</span><span class="NAME">window</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">/*! Element.js >>--E-->
<span class='line'>  3</span>  * documentation: www.elementjs.com
<span class='line'>  4</span>  * 
<span class='line'>  5</span>  */</span><span class="WHIT">
<span class='line'>  6</span> </span></pre></body></html>